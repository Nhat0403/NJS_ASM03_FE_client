{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/funix/NJS301x_1.0-A_VN L\\u1EADp tr\\xECnh Web Back-End v\\u1EDBi NodeJS/assignment 03/Frontend Assignment 03 Client App/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/funix/NJS301x_1.0-A_VN L\\u1EADp tr\\xECnh Web Back-End v\\u1EDBi NodeJS/assignment 03/Frontend Assignment 03 Client App/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/funix/NJS301x_1.0-A_VN L\\u1EADp tr\\xECnh Web Back-End v\\u1EDBi NodeJS/assignment 03/Frontend Assignment 03 Client App/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import'./Chat.css';import queryString from'query-string';import ChatRoomsAPI from'../../API/ChatRoomsAPI';import{useSelector}from'react-redux';import alertify from'alertifyjs';// import io from 'socket.io-client';\n// const socket = io('http://localhost:5000', { transports : ['websocket']});\nfunction Chat(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),activeChat=_useState2[0],setActiveChat=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),textMessage=_useState4[0],setTextMessage=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var _useState7=useState(localStorage.getItem('njs_asm3_roomId')||''),_useState8=_slicedToArray(_useState7,2),roomId=_useState8[0],setRoomId=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),load=_useState10[0],setLoad=_useState10[1];//Get id_user từ redux khi user đã đăng nhập\nvar idUser=useSelector(function(state){return state.Session.idUser;});console.log('chat: '+idUser);// Hàm này dùng để mở hộp thoại chat\nvar onChat=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// const params = {\n// idUser: idUser\n// };\n// const query = '?' + queryString.stringify(params);\n// Check if roomId is null then create new Room\n// if (!roomId && idUser) {\n// await ChatRoomsAPI.createNewRoom();\n// socket.on('create_room', (data) => {\n// \tsetRoomId(data._id);\n// \tlocalStorage.setItem('njs_asm3_roomId', data._id);\n// });\n// \tconst response = await ChatRoomsAPI.createNewRoom(query);\n// \tsetRoomId(response._id);\n// \tlocalStorage.setItem('njs_asm3_roomId', response._id)\n// \tconsole.log(roomId);\n// }\nsetActiveChat(!activeChat);case 1:case\"end\":return _context.stop();}}},_callee);}));return function onChat(){return _ref.apply(this,arguments);};}();var onChangeText=function onChangeText(e){setTextMessage(e.target.value);};var handlerSend=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data,reponse,params,query,response,_reponse;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(idUser){_context2.next=4;break;}alertify.set('notifier','position','bottom-left');alertify.error('Vui Lòng Kiểm Tra Lại Đăng Nhập!');return _context2.abrupt(\"return\");case 4:if(!(roomId&&textMessage.toLowerCase().trim()==='/end')){_context2.next=16;break;}data={message:\"==END ROOM==\",roomId:roomId,// is_admin: false,\nidUser:idUser};// await ChatRoomsAPI.addMessage(data);\n// socket.emit('send_message', data);\n_context2.next=8;return ChatRoomsAPI.addMessage(data);case 8:reponse=_context2.sent;console.log(reponse);localStorage.removeItem('njs_asm3_roomId');setTextMessage('');setRoomId('');setMessage([]);setActiveChat(false);return _context2.abrupt(\"return\");case 16:params={message:textMessage,roomId:roomId,// is_admin: false,\nidUser:idUser};query='?'+queryString.stringify(params);// // Check if roomId is null then create new Room\nif(!(!roomId&&idUser)){_context2.next=25;break;}_context2.next=21;return ChatRoomsAPI.createNewRoom(query);case 21:response=_context2.sent;setRoomId(response._id);localStorage.setItem('njs_asm3_roomId',response._id);console.log(roomId);case 25:if(!(roomId.trim()!==''&&textMessage.trim()!=='')){_context2.next=32;break;}_context2.next=28;return ChatRoomsAPI.addMessage(query);case 28:_reponse=_context2.sent;console.log(_reponse);setTextMessage('');setTimeout(function(){setLoad(true);// socket.emit('send_message', params);\n},200);case 32:case\"end\":return _context2.stop();}}},_callee2);}));return function handlerSend(){return _ref2.apply(this,arguments);};}();var getMessageByRoomId=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return ChatRoomsAPI.getMessageByRoomId(roomId);case 2:response=_context3.sent;console.log(response);setMessage(response.content);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function getMessageByRoomId(){return _ref3.apply(this,arguments);};}();// Hàm này dùng để load dữ liệu message của user khi user gửi tin nhán\nuseEffect(function(){if(load){getMessageByRoomId();console.log('get message');setLoad(false);}},[load]);useEffect(function(){if(roomId.trim()!==''){console.log(roomId);setLoad(true);}},[roomId]);//Hàm này dùng để nhận socket từ server gửi lên\n// useEffect(() => {\n//Nhận dữ liệu từ server gửi lên thông qua socket với key receive_message\n// socket.on('receive_message', (data) => {\n// \t// console.log(data);\n// \t// setMessage(data.content);\n// \t//Sau đó nó sẽ setLoad gọi lại hàm useEffect lấy lại dữ liệu\n// \tsetLoad(true);\n// });\n// setLoad(true);\n// }, []);\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper_chat\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat_messenger\",onClick:onChat,children:/*#__PURE__*/_jsx(\"svg\",{x:\"0\",y:\"0\",width:\"60px\",height:\"60px\",children:/*#__PURE__*/_jsx(\"g\",{stroke:\"none\",strokeWidth:\"1\",fill:\"none\",fillRule:\"evenodd\",children:/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(\"circle\",{fill:\"#383838\",cx:\"30\",cy:\"30\",r:\"30\"}),/*#__PURE__*/_jsx(\"svg\",{x:\"10\",y:\"10\",children:/*#__PURE__*/_jsx(\"g\",{transform:\"translate(0.000000, -10.000000)\",fill:\"#FFFFFF\",children:/*#__PURE__*/_jsx(\"g\",{id:\"logo\",transform:\"translate(0.000000, 10.000000)\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M20,0 C31.2666,0 40,8.2528 40,19.4 C40,30.5472 31.2666,38.8  20,38.8 C17.9763,38.8 16.0348,38.5327 14.2106,38.0311 C13.856,37.9335 13.4789,37.9612  13.1424,38.1098 L9.1727,39.8621 C8.1343,40.3205 6.9621,39.5819 6.9273,38.4474 L6.8184,34.8894  C6.805,34.4513 6.6078,34.0414 6.2811,33.7492 C2.3896,30.2691 0,25.2307 0,19.4 C0,8.2528 8.7334,0  20,0 Z M7.99009,25.07344 C7.42629,25.96794 8.52579,26.97594 9.36809,26.33674 L15.67879,21.54734  C16.10569,21.22334 16.69559,21.22164 17.12429,21.54314 L21.79709,25.04774 C23.19919,26.09944  25.20039,25.73014 26.13499,24.24744 L32.00999,14.92654 C32.57369,14.03204 31.47419,13.02404  30.63189,13.66324 L24.32119,18.45264 C23.89429,18.77664 23.30439,18.77834 22.87569,18.45674  L18.20299,14.95224 C16.80079,13.90064 14.79959,14.26984 13.86509,15.75264 L7.99009,25.07344 Z\"})})})})]})})})}),activeChat&&/*#__PURE__*/_jsx(\"div\",{className:\"active_chat animate__animated animate__jackInTheBox\",children:/*#__PURE__*/_jsx(\"div\",{style:{width:'100%'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"card card-bordered fix_boderChat\",style:{width:\"fit-content\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"card-title\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Customer Support\"})}),' ',/*#__PURE__*/_jsx(\"a\",{className:\"btn btn-xs btn-secondary\",href:\"#\",children:\"Let's Chat App\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ps-container ps-theme-default ps-active-y fix_scoll\",children:message&&message.map(function(value,index){return index===0?/*#__PURE__*/_jsxs(\"div\",{className:\"media media-chat\",style:{display:'none'},children:[' ',/*#__PURE__*/_jsx(\"img\",{className:\"avatar\",src:\"https://img.icons8.com/color/36/000000/administrator-male.png\",alt:\"...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"media-body\",children:/*#__PURE__*/_jsx(\"p\",{children:value.message+index})},value.id)]},value._id):!value.is_admin?/*#__PURE__*/_jsx(\"div\",{className:\"media media-chat media-chat-reverse\",children:/*#__PURE__*/_jsx(\"div\",{className:\"media-body\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"You: \",value.message]})})},value._id):/*#__PURE__*/_jsxs(\"div\",{className:\"media media-chat\",children:[' ',/*#__PURE__*/_jsx(\"img\",{className:\"avatar\",src:\"https://img.icons8.com/color/36/000000/administrator-male.png\",alt:\"...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"media-body\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"C\\u1ED9ng t\\xE1c vi\\xEAn: \",value.message]})},value.id)]},value._id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"publisher bt-1 border-light\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"avatar avatar-xs\",src:\"https://img.icons8.com/color/36/000000/administrator-male.png\",alt:\"...\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter Message!\",onChange:onChangeText,value:textMessage,style:{width:\"80%\"},onKeyPress:function onKeyPress(e){if(e.key==='Enter'){handlerSend();}}}),/*#__PURE__*/_jsx(\"a\",{onClick:handlerSend,className:\"publisher-btn text-info\",\"data-abc\":\"true\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-paper-plane\"})})]})]})})})]});}export default Chat;","map":{"version":3,"sources":["D:/funix/NJS301x_1.0-A_VN Lập trình Web Back-End với NodeJS/assignment 03/Frontend Assignment 03 Client App/src/Share/Chat/Chat.jsx"],"names":["React","useEffect","useState","queryString","ChatRoomsAPI","useSelector","alertify","Chat","props","activeChat","setActiveChat","textMessage","setTextMessage","message","setMessage","localStorage","getItem","roomId","setRoomId","load","setLoad","idUser","state","Session","console","log","onChat","onChangeText","e","target","value","handlerSend","set","error","toLowerCase","trim","data","addMessage","reponse","removeItem","params","query","stringify","createNewRoom","response","_id","setItem","setTimeout","getMessageByRoomId","content","width","map","index","display","id","is_admin","key"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport './Chat.css';\nimport queryString from 'query-string';\nimport ChatRoomsAPI from '../../API/ChatRoomsAPI';\nimport { useSelector } from 'react-redux';\nimport alertify from 'alertifyjs';\n// import io from 'socket.io-client';\n// const socket = io('http://localhost:5000', { transports : ['websocket']});\n\nfunction Chat(props) {\n\tconst [activeChat, setActiveChat] = useState(false);\n\tconst [textMessage, setTextMessage] = useState('');\n\tconst [message, setMessage] = useState();\n\tconst [roomId, setRoomId] = useState(localStorage.getItem('njs_asm3_roomId') || '');\n\tconst [load, setLoad] = useState(false);\n\t\n\t//Get id_user từ redux khi user đã đăng nhập\n\tconst idUser = useSelector((state) => state.Session.idUser);\n\tconsole.log('chat: ' + idUser);\n\n\t// Hàm này dùng để mở hộp thoại chat\n\tconst onChat = async () => {\t\t\n\t\t// const params = {\n\t\t\t// idUser: idUser\n\t\t// };\n\t\t// const query = '?' + queryString.stringify(params);\n\t\t// Check if roomId is null then create new Room\n\t\t// if (!roomId && idUser) {\n\t\t\t// await ChatRoomsAPI.createNewRoom();\n\t\t\t// socket.on('create_room', (data) => {\n\t\t\t\t// \tsetRoomId(data._id);\n\t\t\t\t// \tlocalStorage.setItem('njs_asm3_roomId', data._id);\n\t\t\t\t// });\n\t\t// \tconst response = await ChatRoomsAPI.createNewRoom(query);\n\t\t// \tsetRoomId(response._id);\n\t\t// \tlocalStorage.setItem('njs_asm3_roomId', response._id)\n\t\t// \tconsole.log(roomId);\n\t\t// }\n\t\tsetActiveChat(!activeChat);\n\t};\n\n\tconst onChangeText = (e) => {\n\t\tsetTextMessage(e.target.value);\n\t};\n\n\tconst handlerSend = async () => {\n\t\tif(!idUser) {\n\t\t\talertify.set('notifier', 'position', 'bottom-left');\n\t\t\talertify.error('Vui Lòng Kiểm Tra Lại Đăng Nhập!');\n\t\t\treturn;\n\t\t}\n\t\t//Sau đó nó emit dữ liệu lên server bằng socket với key send_message và value data\n\t\t// Check if text equal \"/end\" then end room\n\t\tif(roomId && textMessage.toLowerCase().trim() === '/end') {\n\t\t\tconst data = {\n\t\t\t\tmessage: \"==END ROOM==\",\n\t\t\t\troomId: roomId,\n\t\t\t\t// is_admin: false,\n\t\t\t\tidUser: idUser\n\t\t\t};\n\t\t\t// await ChatRoomsAPI.addMessage(data);\n\t\t\t// socket.emit('send_message', data);\n\t\t\tconst reponse = await ChatRoomsAPI.addMessage(data);\n\t\t\tconsole.log(reponse);\n\n\t\t\tlocalStorage.removeItem('njs_asm3_roomId');\n\t\t\tsetTextMessage('');\n\t\t\tsetRoomId('');\n\t\t\tsetMessage([]);\n\t\t\tsetActiveChat(false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {\n\t\t\tmessage: textMessage,\n\t\t\troomId: roomId,\n\t\t\t// is_admin: false,\n\t\t\tidUser: idUser\n\t\t};\n\t\tconst query = '?' + queryString.stringify(params);\n\n\t\t// // Check if roomId is null then create new Room\n\t\tif (!roomId && idUser) {\n\t\t// await ChatRoomsAPI.createNewRoom();\n\t\t// \t// socket.on('create_room', (data) => {\n\t\t// \t\t// \tsetRoomId(data._id);\n\t\t// \t\t// \tlocalStorage.setItem('njs_asm3_roomId', data._id);\n\t\t// \t\t// });\n\t\t\tconst response = await ChatRoomsAPI.createNewRoom(query);\n\t\t\tsetRoomId(response._id);\n\t\t\tlocalStorage.setItem('njs_asm3_roomId', response._id)\n\t\t\tconsole.log(roomId);\n\t\t}\n\t\t//Tiếp theo nó sẽ postdata lên api đưa dữ liệu vào database\n\t\tif(roomId.trim() !== '' && textMessage.trim() !== '') {\n\t\t\t// await ChatRoomsAPI.addMessage(query);\n\t\t\t// socket.emit('send_message', query);\n\n\t\t\tconst reponse = await ChatRoomsAPI.addMessage(query);\n\t\t\tconsole.log(reponse);\n\n\t\t\tsetTextMessage('');\n\t\t\t\n\t\t\tsetTimeout(() => {\n\t\t\t\tsetLoad(true);\n\t\t\t\t// socket.emit('send_message', params);\n\t\t\t}, 200);\n\t\t}\n\t};\n\n\tconst getMessageByRoomId = async () => {\n\t\t// await ChatRoomsAPI.getMessageByRoomId(roomId);\n\t\tconst response = await ChatRoomsAPI.getMessageByRoomId(roomId);\n\t\tconsole.log(response);\n\t\tsetMessage(response.content);\n\t};\n\n\t// Hàm này dùng để load dữ liệu message của user khi user gửi tin nhán\n\tuseEffect(() => {\n\t\tif (load) {\n\t\t\tgetMessageByRoomId();\n\t\t\tconsole.log('get message')\n\t\t\tsetLoad(false);\n\t\t}\n\t}, [load]);\n\n\n\tuseEffect(() => {\n\t\tif(roomId.trim() !== '') {\n\t\t\tconsole.log(roomId);\n\t\t\tsetLoad(true);\n\t\t}\n\t}, [roomId]);\n\n\t//Hàm này dùng để nhận socket từ server gửi lên\n\t// useEffect(() => {\n\t\t//Nhận dữ liệu từ server gửi lên thông qua socket với key receive_message\n\t\t// socket.on('receive_message', (data) => {\n\t\t// \t// console.log(data);\n\t\t// \t// setMessage(data.content);\n\t\t// \t//Sau đó nó sẽ setLoad gọi lại hàm useEffect lấy lại dữ liệu\n\t\t// \tsetLoad(true);\n\t\t// });\n\t\t// setLoad(true);\n\t// }, []);\n\n\treturn (\n\t\t<div className='wrapper_chat'>\n\t\t\t<div className='chat_messenger' onClick={onChat}>\n\t\t\t\t<svg x='0' y='0' width='60px' height='60px'>\n\t\t\t\t\t<g stroke='none' strokeWidth='1' fill='none' fillRule='evenodd'>\n\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t<circle fill='#383838' cx='30' cy='30' r='30'></circle>\n\t\t\t\t\t\t\t<svg x='10' y='10'>\n\t\t\t\t\t\t\t\t<g\n\t\t\t\t\t\t\t\t\ttransform='translate(0.000000, -10.000000)'\n\t\t\t\t\t\t\t\t\tfill='#FFFFFF'>\n\t\t\t\t\t\t\t\t\t<g\n\t\t\t\t\t\t\t\t\t\tid='logo'\n\t\t\t\t\t\t\t\t\t\ttransform='translate(0.000000, 10.000000)'>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td='M20,0 C31.2666,0 40,8.2528 40,19.4 C40,30.5472 31.2666,38.8 \n\t\t\t\t\t\t\t\t20,38.8 C17.9763,38.8 16.0348,38.5327 14.2106,38.0311 C13.856,37.9335 13.4789,37.9612 \n\t\t\t\t\t\t\t\t13.1424,38.1098 L9.1727,39.8621 C8.1343,40.3205 6.9621,39.5819 6.9273,38.4474 L6.8184,34.8894 \n\t\t\t\t\t\t\t\tC6.805,34.4513 6.6078,34.0414 6.2811,33.7492 C2.3896,30.2691 0,25.2307 0,19.4 C0,8.2528 8.7334,0 \n\t\t\t\t\t\t\t\t20,0 Z M7.99009,25.07344 C7.42629,25.96794 8.52579,26.97594 9.36809,26.33674 L15.67879,21.54734 \n\t\t\t\t\t\t\t\tC16.10569,21.22334 16.69559,21.22164 17.12429,21.54314 L21.79709,25.04774 C23.19919,26.09944 \n\t\t\t\t\t\t\t\t25.20039,25.73014 26.13499,24.24744 L32.00999,14.92654 C32.57369,14.03204 31.47419,13.02404 \n\t\t\t\t\t\t\t\t30.63189,13.66324 L24.32119,18.45264 C23.89429,18.77664 23.30439,18.77834 22.87569,18.45674 \n\t\t\t\t\t\t\t\tL18.20299,14.95224 C16.80079,13.90064 14.79959,14.26984 13.86509,15.75264 L7.99009,25.07344 Z'></path>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t{activeChat && (\n\t\t\t\t<div className='active_chat animate__animated animate__jackInTheBox'>\n\t\t\t\t\t<div style={{ width: '100%' }}>\n\t\t\t\t\t\t<div className='card card-bordered fix_boderChat' style={{width: \"fit-content\"}}>\n\t\t\t\t\t\t\t<div className='card-header'>\n\t\t\t\t\t\t\t\t<h4 className='card-title'>\n\t\t\t\t\t\t\t\t\t<strong>Customer Support</strong>\n\t\t\t\t\t\t\t\t</h4>{' '}\n\t\t\t\t\t\t\t\t<a className='btn btn-xs btn-secondary' href='#'>\n\t\t\t\t\t\t\t\t\tLet's Chat App\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className='ps-container ps-theme-default ps-active-y fix_scoll'>\n\t\t\t\t\t\t\t\t{message &&\n\t\t\t\t\t\t\t\t\tmessage.map((value, index) =>\n\t\t\t\t\t\t\t\t\t\tindex === 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName='media media-chat'\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ display: 'none' }}\n\t\t\t\t\t\t\t\t\t\t\t\tkey={value._id}>\n\t\t\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='avatar'\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc='https://img.icons8.com/color/36/000000/administrator-male.png'\n\t\t\t\t\t\t\t\t\t\t\t\t\talt='...'\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className='media-body' key={value.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p>{value.message + index}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t!value.is_admin ? (\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='media media-chat media-chat-reverse'\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={value._id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className='media-body'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>You: {value.message}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='media media-chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={value._id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='avatar'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc='https://img.icons8.com/color/36/000000/administrator-male.png'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt='...'\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className='media-body' key={value.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>Cộng tác viên: {value.message}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className='publisher bt-1 border-light'>\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tclassName='avatar avatar-xs'\n\t\t\t\t\t\t\t\t\tsrc='https://img.icons8.com/color/36/000000/administrator-male.png'\n\t\t\t\t\t\t\t\t\talt='...'\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\t\t\t\tplaceholder='Enter Message!'\n\t\t\t\t\t\t\t\t\tonChange={onChangeText}\n\t\t\t\t\t\t\t\t\tvalue={textMessage}\n\t\t\t\t\t\t\t\t\tstyle={{width: \"80%\"}}\n\t\t\t\t\t\t\t\t\tonKeyPress={(e) => {\n\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\thandlerSend();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tonClick={handlerSend}\n\t\t\t\t\t\t\t\t\tclassName='publisher-btn text-info'\n\t\t\t\t\t\t\t\t\tdata-abc='true'>\n\t\t\t\t\t\t\t\t\t<i className='fa fa-paper-plane'></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}