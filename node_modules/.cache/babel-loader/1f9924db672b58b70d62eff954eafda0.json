{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/funix/NJS301x_1.0-A_VN L\\u1EADp tr\\xECnh Web Back-End v\\u1EDBi NodeJS/assignment 03/Frontend Assignment 03 Client App/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/funix/NJS301x_1.0-A_VN L\\u1EADp tr\\xECnh Web Back-End v\\u1EDBi NodeJS/assignment 03/Frontend Assignment 03 Client App/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/funix/NJS301x_1.0-A_VN L\\u1EADp tr\\xECnh Web Back-End v\\u1EDBi NodeJS/assignment 03/Frontend Assignment 03 Client App/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{deleteCart,updateCart}from'../Redux/Action/ActionCart';import ListCart from'./Component/ListCart';import alertify from'alertifyjs';import{Link,Redirect}from'react-router-dom';import CartAPI from'../API/CartAPI';import queryString from'query-string';import convertMoney from'../convertMoney';function Cart(props){var token=document.cookie.split('=')[1];var idUser=useSelector(function(state){return state.Session.idUser;});//id_user được lấy từ redux\nvar id_user=useSelector(function(state){return state.Cart.id_user;});//listCart được lấy từ redux\nvar listCart=useSelector(function(state){return state.Cart.listCart;});var _useState=useState([]),_useState2=_slicedToArray(_useState,2),cart=_useState2[0],setCart=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),total=_useState4[0],setTotal=_useState4[1];var dispatch=useDispatch();//State dùng để Load dữ liệu từ Redux\nvar _useState5=useState({idProduct:'',count:''}),_useState6=_slicedToArray(_useState5,2),loadRedux=_useState6[0],setLoadRedux=_useState6[1];//State dùng để Load dữ liệu từ API\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loadAPI=_useState8[0],setLoadAPI=_useState8[1];//Hàm này dùng để Load dữ liệu ở Redux\n//Khi người dùng chưa đăng nhập\nuseEffect(function(){var fetchDataRedux=function fetchDataRedux(){if(!localStorage.getItem('id_user')){setCart(listCart);getTotal(listCart);}};fetchDataRedux();},[loadRedux]);//Hàm này dùng để tính tổng tiền carts\nfunction getTotal(carts){var sub_total=0;var sum_total=carts.map(function(value){return sub_total+=parseInt(value.productId.price)*parseInt(value.quantity);});setTotal(sub_total);}//Hàm này dùng để load dữ liệu từ API\n//Khi người dùng đã đăng nhập\nuseEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var params,query,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!localStorage.getItem('id_user')){_context.next=9;break;}params={idUser:localStorage.getItem('id_user')};query='?'+queryString.stringify(params);console.log(query);_context.next=6;return CartAPI.getCarts(query);case 6:response=_context.sent;setCart(response);getTotal(response);case 9:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();setLoadAPI(false);},[loadAPI]);console.log(cart);//Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\nvar onDeleteCart=function onDeleteCart(getUser,getProduct){console.log('idUser: '+getUser+', idProduct: '+getProduct);if(localStorage.getItem('id_user')){// user đã đăng nhập\n//Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\nvar fetchDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,query,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params={idUser:getUser,idProduct:getProduct};query='?'+queryString.stringify(params);_context2.next=4;return CartAPI.deleteToCart(query);case 4:response=_context2.sent;console.log(response);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchDelete(){return _ref2.apply(this,arguments);};}();fetchDelete();//Sau đó thay đổi state loadAPI và load lại hàm useEffect\nsetLoadAPI(true);alertify.set('notifier','position','bottom-left');alertify.error('Bạn Đã Xóa Hàng Thành Công!');}else{// user chưa đăng nhập\n//Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\nvar data={idProduct:getProduct,idUser:getUser};//Đưa dữ liệu vào Redux\nvar action=deleteCart(data);dispatch(action);alertify.set('notifier','position','bottom-left');alertify.error('Bạn Đã Xóa Hàng Thành Công!');//set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\nsetLoadRedux({idProduct:getProduct,count:''});}};//Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\nvar onUpdateCount=function onUpdateCount(getUser,getProduct,getCount){console.log('Count: '+getCount+', idUser: '+getUser+', idProduct: '+getProduct);if(localStorage.getItem('id_user')){// user đã đăng nhập\n//Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\nvar fetchPut=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var params,query,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:params={idUser:getUser,idProduct:getProduct,count:getCount};console.log(params);query='?'+queryString.stringify(params);_context3.next=5;return CartAPI.putToCart(query);case 5:response=_context3.sent;console.log(response);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchPut(){return _ref3.apply(this,arguments);};}();fetchPut();//Sau đó thay đổi state loadAPI và load lại hàm useEffect\nsetLoadAPI(true);console.log('Ban Da Dang Nhap!');alertify.set('notifier','position','bottom-left');alertify.success('Bạn Đã Sửa Hàng Thành Công!');}else{//Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\nvar data={idProduct:getProduct,idUser:getUser,count:getCount};//Đưa dữ liệu vào Redux\nvar action=updateCart(data);dispatch(action);alertify.set('notifier','position','bottom-left');alertify.success('Bạn Đã Sửa Hàng Thành Công!');//set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\nsetLoadRedux({idProduct:getProduct,count:getCount});}};//Hàm này dùng để redirect đến page checkout\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),redirect=_useState10[0],setRedirect=_useState10[1];var onCheckout=function onCheckout(){if(!idUser||!token){alertify.set('notifier','position','bottom-left');alertify.error('Vui Lòng Kiểm Tra Lại Đăng Nhập!');return;}if(cart.length===0){alertify.set('notifier','position','bottom-left');alertify.error('Vui Lòng Kiểm Tra Lại Giỏ Hàng!');return;}setRedirect(true);};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"section\",{className:\"py-5 bg-light\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row px-4 px-lg-5 py-lg-4 align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"h2 text-uppercase mb-0\",children:\"Cart\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-6 text-lg-right\",children:/*#__PURE__*/_jsx(\"nav\",{\"aria-label\":\"breadcrumb\",children:/*#__PURE__*/_jsx(\"ol\",{className:\"breadcrumb justify-content-lg-end mb-0 px-0\",children:/*#__PURE__*/_jsx(\"li\",{className:\"breadcrumb-item active\",\"aria-current\":\"page\",children:\"Cart\"})})})})]})})}),/*#__PURE__*/_jsxs(\"section\",{className:\"py-5\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"h5 text-uppercase mb-4\",children:\"Shopping cart\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-8 mb-4 mb-lg-0\",children:[/*#__PURE__*/_jsx(ListCart,{listCart:cart,onDeleteCart:onDeleteCart,onUpdateCount:onUpdateCount}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-light px-4 py-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row align-items-center text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 mb-3 mb-md-0 text-md-left\",children:/*#__PURE__*/_jsxs(Link,{className:\"btn btn-link p-0 text-dark btn-sm\",to:\"/shop\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-long-arrow-alt-left mr-2\",children:' '}),\"Continue shopping\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 text-md-right\",children:[redirect&&/*#__PURE__*/_jsx(Redirect,{to:'/checkout'}),/*#__PURE__*/_jsxs(\"span\",{className:\"btn btn-outline-dark btn-sm\",onClick:onCheckout,children:[\"Proceed to checkout\",/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-long-arrow-alt-right ml-2\"})]})]})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card border-0 rounded-0 p-lg-4 bg-light\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-uppercase mb-4\",children:\"Cart total\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-unstyled mb-0\",children:[/*#__PURE__*/_jsxs(\"li\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"text-uppercase small font-weight-bold\",children:\"Subtotal\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-muted small\",children:[convertMoney(total),\" VND\"]})]}),/*#__PURE__*/_jsx(\"li\",{className:\"border-bottom my-2\"}),/*#__PURE__*/_jsxs(\"li\",{className:\"d-flex align-items-center justify-content-between mb-4\",children:[/*#__PURE__*/_jsx(\"strong\",{className:\"text-uppercase small font-weight-bold\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"span\",{children:[convertMoney(total),\" VND\"]})]})]})]})})})]})]})]});}export default Cart;","map":{"version":3,"sources":["D:/funix/NJS301x_1.0-A_VN Lập trình Web Back-End với NodeJS/assignment 03/Frontend Assignment 03 Client App/src/Cart/Cart.jsx"],"names":["React","useEffect","useState","useDispatch","useSelector","deleteCart","updateCart","ListCart","alertify","Link","Redirect","CartAPI","queryString","convertMoney","Cart","props","token","document","cookie","split","idUser","state","Session","id_user","listCart","cart","setCart","total","setTotal","dispatch","idProduct","count","loadRedux","setLoadRedux","loadAPI","setLoadAPI","fetchDataRedux","localStorage","getItem","getTotal","carts","sub_total","sum_total","map","value","parseInt","productId","price","quantity","fetchData","params","query","stringify","console","log","getCarts","response","onDeleteCart","getUser","getProduct","fetchDelete","deleteToCart","set","error","data","action","onUpdateCount","getCount","fetchPut","putToCart","success","redirect","setRedirect","onCheckout","length"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { deleteCart, updateCart } from '../Redux/Action/ActionCart';\nimport ListCart from './Component/ListCart';\nimport alertify from 'alertifyjs';\nimport { Link, Redirect } from 'react-router-dom';\nimport CartAPI from '../API/CartAPI';\nimport queryString from 'query-string';\nimport convertMoney from '../convertMoney';\n\nfunction Cart(props) {\n\tconst token = document.cookie.split('=')[1];\n\tconst idUser = useSelector((state) => state.Session.idUser);\n\t//id_user được lấy từ redux\n\tconst id_user = useSelector((state) => state.Cart.id_user);\n\n\t//listCart được lấy từ redux\n\tconst listCart = useSelector((state) => state.Cart.listCart);\n\n\tconst [cart, setCart] = useState([]);\n\n\tconst [total, setTotal] = useState();\n\n\tconst dispatch = useDispatch();\n\n\t//State dùng để Load dữ liệu từ Redux\n\tconst [loadRedux, setLoadRedux] = useState({\n\t\tidProduct: '',\n\t\tcount: '',\n\t});\n\n\t//State dùng để Load dữ liệu từ API\n\tconst [loadAPI, setLoadAPI] = useState(false);\n\n\t//Hàm này dùng để Load dữ liệu ở Redux\n\t//Khi người dùng chưa đăng nhập\n\tuseEffect(() => {\n\t\tconst fetchDataRedux = () => {\n\t\t\tif (!localStorage.getItem('id_user')) {\n\t\t\t\tsetCart(listCart);\n\n\t\t\t\tgetTotal(listCart);\n\t\t\t}\n\t\t};\n\n\t\tfetchDataRedux();\n\t}, [loadRedux]);\n\n\t//Hàm này dùng để tính tổng tiền carts\n\tfunction getTotal(carts) {\n\t\tlet sub_total = 0;\n\n\t\tconst sum_total = carts.map((value) => {\n\t\t\treturn (sub_total +=\n\t\t\t\tparseInt(value.productId.price) * parseInt(value.quantity));\n\t\t});\n\n\t\tsetTotal(sub_total);\n\t}\n\n\t//Hàm này dùng để load dữ liệu từ API\n\t//Khi người dùng đã đăng nhập\n\tuseEffect(() => {\n\t\tconst fetchData = async () => {\n\t\t\tif (localStorage.getItem('id_user')) {\n\t\t\t\tconst params = {\n\t\t\t\t\tidUser: localStorage.getItem('id_user'),\n\t\t\t\t};\n\n\t\t\t\tconst query = '?' + queryString.stringify(params);\n\n\t\t\t\tconsole.log(query);\n\n\t\t\t\tconst response = await CartAPI.getCarts(query);\n\n\t\t\t\tsetCart(response);\n\n\t\t\t\tgetTotal(response);\n\t\t\t}\n\t\t};\n\n\t\tfetchData();\n\n\t\tsetLoadAPI(false);\n\t}, [loadAPI]);\n\n\tconsole.log(cart);\n\n\t//Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\n\tconst onDeleteCart = (getUser, getProduct) => {\n\t\tconsole.log('idUser: ' + getUser + ', idProduct: ' + getProduct);\n\n\t\tif (localStorage.getItem('id_user')) {\n\t\t\t// user đã đăng nhập\n\n\t\t\t//Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\n\t\t\tconst fetchDelete = async () => {\n\t\t\t\tconst params = {\n\t\t\t\t\tidUser: getUser,\n\t\t\t\t\tidProduct: getProduct,\n\t\t\t\t};\n\n\t\t\t\tconst query = '?' + queryString.stringify(params);\n\n\t\t\t\tconst response = await CartAPI.deleteToCart(query);\n\t\t\t\tconsole.log(response);\n\t\t\t};\n\n\t\t\tfetchDelete();\n\n\t\t\t//Sau đó thay đổi state loadAPI và load lại hàm useEffect\n\t\t\tsetLoadAPI(true);\n\n\t\t\talertify.set('notifier', 'position', 'bottom-left');\n\t\t\talertify.error('Bạn Đã Xóa Hàng Thành Công!');\n\t\t} else {\n\t\t\t// user chưa đăng nhập\n\n\t\t\t//Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\n\t\t\tconst data = {\n\t\t\t\tidProduct: getProduct,\n\t\t\t\tidUser: getUser,\n\t\t\t};\n\n\t\t\t//Đưa dữ liệu vào Redux\n\t\t\tconst action = deleteCart(data);\n\t\t\tdispatch(action);\n\n\t\t\talertify.set('notifier', 'position', 'bottom-left');\n\t\t\talertify.error('Bạn Đã Xóa Hàng Thành Công!');\n\n\t\t\t//set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\n\t\t\tsetLoadRedux({\n\t\t\t\tidProduct: getProduct,\n\t\t\t\tcount: '',\n\t\t\t});\n\t\t}\n\t};\n\n\t//Hàm này dùng để truyền xuống cho component con xử và trả ngược dữ liệu lại component cha\n\tconst onUpdateCount = (getUser, getProduct, getCount) => {\n\t\tconsole.log(\n\t\t\t'Count: ' +\n\t\t\t\tgetCount +\n\t\t\t\t', idUser: ' +\n\t\t\t\tgetUser +\n\t\t\t\t', idProduct: ' +\n\t\t\t\tgetProduct\n\t\t);\n\n\t\tif (localStorage.getItem('id_user')) {\n\t\t\t// user đã đăng nhập\n\n\t\t\t//Sau khi nhận được dữ liệu ở component con truyền lên thì sẽ gọi API xử lý dữ liệu\n\t\t\tconst fetchPut = async () => {\n\t\t\t\tconst params = {\n\t\t\t\t\tidUser: getUser,\n\t\t\t\t\tidProduct: getProduct,\n\t\t\t\t\tcount: getCount,\n\t\t\t\t};\n\n\t\t\t\tconsole.log(params);\n\t\t\t\tconst query = '?' + queryString.stringify(params);\n\n\t\t\t\tconst response = await CartAPI.putToCart(query);\n\t\t\t\tconsole.log(response);\n\t\t\t};\n\n\t\t\tfetchPut();\n\n\t\t\t//Sau đó thay đổi state loadAPI và load lại hàm useEffect\n\t\t\tsetLoadAPI(true);\n\n\t\t\tconsole.log('Ban Da Dang Nhap!');\n\n\t\t\talertify.set('notifier', 'position', 'bottom-left');\n\t\t\talertify.success('Bạn Đã Sửa Hàng Thành Công!');\n\t\t} else {\n\t\t\t//Nếu không có phiên làm việc của Session User thì mình sẽ xử lý với Redux\n\t\t\tconst data = {\n\t\t\t\tidProduct: getProduct,\n\t\t\t\tidUser: getUser,\n\t\t\t\tcount: getCount,\n\t\t\t};\n\n\t\t\t//Đưa dữ liệu vào Redux\n\t\t\tconst action = updateCart(data);\n\t\t\tdispatch(action);\n\n\t\t\talertify.set('notifier', 'position', 'bottom-left');\n\t\t\talertify.success('Bạn Đã Sửa Hàng Thành Công!');\n\n\t\t\t//set state loadRedux để nó load lại hàm useEffect để tiếp tục lấy dữ liệu từ redux\n\t\t\tsetLoadRedux({\n\t\t\t\tidProduct: getProduct,\n\t\t\t\tcount: getCount,\n\t\t\t});\n\t\t}\n\t};\n\n\t//Hàm này dùng để redirect đến page checkout\n\tconst [redirect, setRedirect] = useState(false);\n\n\tconst onCheckout = () => {\n\t\tif (!idUser || !token) {\n\t\t\talertify.set('notifier', 'position', 'bottom-left');\n\t\t\talertify.error('Vui Lòng Kiểm Tra Lại Đăng Nhập!');\n\t\t\treturn;\n\t\t}\n\n\t\tif (cart.length === 0) {\n\t\t\talertify.set('notifier', 'position', 'bottom-left');\n\t\t\talertify.error('Vui Lòng Kiểm Tra Lại Giỏ Hàng!');\n\t\t\treturn;\n\t\t}\n\n\t\tsetRedirect(true);\n\t};\n\n\treturn (\n\t\t<div className='container'>\n\t\t\t<section className='py-5 bg-light'>\n\t\t\t\t<div className='container'>\n\t\t\t\t\t<div className='row px-4 px-lg-5 py-lg-4 align-items-center'>\n\t\t\t\t\t\t<div className='col-lg-6'>\n\t\t\t\t\t\t\t<h1 className='h2 text-uppercase mb-0'>Cart</h1>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className='col-lg-6 text-lg-right'>\n\t\t\t\t\t\t\t<nav aria-label='breadcrumb'>\n\t\t\t\t\t\t\t\t<ol className='breadcrumb justify-content-lg-end mb-0 px-0'>\n\t\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t\tclassName='breadcrumb-item active'\n\t\t\t\t\t\t\t\t\t\taria-current='page'>\n\t\t\t\t\t\t\t\t\t\tCart\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ol>\n\t\t\t\t\t\t\t</nav>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>\n\t\t\t<section className='py-5'>\n\t\t\t\t<h2 className='h5 text-uppercase mb-4'>Shopping cart</h2>\n\t\t\t\t<div className='row'>\n\t\t\t\t\t<div className='col-lg-8 mb-4 mb-lg-0'>\n\t\t\t\t\t\t<ListCart\n\t\t\t\t\t\t\tlistCart={cart}\n\t\t\t\t\t\t\tonDeleteCart={onDeleteCart}\n\t\t\t\t\t\t\tonUpdateCount={onUpdateCount}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<div className='bg-light px-4 py-3'>\n\t\t\t\t\t\t\t<div className='row align-items-center text-center'>\n\t\t\t\t\t\t\t\t<div className='col-md-6 mb-3 mb-md-0 text-md-left'>\n\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\tclassName='btn btn-link p-0 text-dark btn-sm'\n\t\t\t\t\t\t\t\t\t\tto={`/shop`}>\n\t\t\t\t\t\t\t\t\t\t<i className='fas fa-long-arrow-alt-left mr-2'>\n\t\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t\t\t\t\tContinue shopping\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className='col-md-6 text-md-right'>\n\t\t\t\t\t\t\t\t\t{redirect && <Redirect to={'/checkout'} />}\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclassName='btn btn-outline-dark btn-sm'\n\t\t\t\t\t\t\t\t\t\tonClick={onCheckout}>\n\t\t\t\t\t\t\t\t\t\tProceed to checkout\n\t\t\t\t\t\t\t\t\t\t<i className='fas fa-long-arrow-alt-right ml-2'></i>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className='col-lg-4'>\n\t\t\t\t\t\t<div className='card border-0 rounded-0 p-lg-4 bg-light'>\n\t\t\t\t\t\t\t<div className='card-body'>\n\t\t\t\t\t\t\t\t<h5 className='text-uppercase mb-4'>Cart total</h5>\n\t\t\t\t\t\t\t\t<ul className='list-unstyled mb-0'>\n\t\t\t\t\t\t\t\t\t<li className='d-flex align-items-center justify-content-between'>\n\t\t\t\t\t\t\t\t\t\t<strong className='text-uppercase small font-weight-bold'>\n\t\t\t\t\t\t\t\t\t\t\tSubtotal\n\t\t\t\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t\t\t\t\t<span className='text-muted small'>\n\t\t\t\t\t\t\t\t\t\t\t{convertMoney(total)} VND\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t<li className='border-bottom my-2'></li>\n\t\t\t\t\t\t\t\t\t<li className='d-flex align-items-center justify-content-between mb-4'>\n\t\t\t\t\t\t\t\t\t\t<strong className='text-uppercase small font-weight-bold'>\n\t\t\t\t\t\t\t\t\t\t\tTotal\n\t\t\t\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t\t\t\t\t<span>{convertMoney(total)} VND</span>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>\n\t\t</div>\n\t);\n}\n\nexport default Cart;\n"]},"metadata":{},"sourceType":"module"}